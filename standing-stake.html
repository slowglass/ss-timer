<html>
	<head>
		<meta name="apple-mobile-web-app-capable" content="yes">

		<link rel="stylesheet" href="jquery-ui.css">
		<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
    	<link rel="stylesheet" type="text/css" href="css/standing-stake.css">
		<link rel="icon" type="image/x-icon" href="taichi.png" /> 

		<link rel="apple-touch-icon" href="taichi.png" />
		<link rel="apple-touch-icon" sizes="57x57" href="taichi_57.png" />
		<link rel="apple-touch-icon" sizes="72x72" href="taichi_72.png" />
		<link rel="apple-touch-icon" sizes="114x114" href="taichi_114.png" />
		<link rel="apple-touch-icon" sizes="144x144" href="taichi_144.png" />

		<link href="https://fonts.googleapis.com/css?family=Raleway:400,700" rel="stylesheet" type="text/css">

		<script type="text/javascript" src="https://code.jquery.com/jquery-1.11.0.min.js"></script>
		<script src="jquery-ui.js"></script>
		<script src="howler2.js"></script>
		<script src="NoSleep.js"></script>

		<script type="text/javascript" src="js/kinetic.js"></script>
		<script type="text/javascript" src="js/jquery.final-countdown.js"></script>

	</head>
	<body>
	<div class="buttons">
		<div class="section group repeat">
			<div class="col cell btn">1</div>
			<div class="col cell btn">2</div>
			<div class="col cell btn">3</div>
			<div class="col cell btn">4</div>
		</div>
                <div class="section group repeat">
                        <div class="col cell btn">5</div>
                        <div class="col cell btn">6</div>
                        <div class="col cell btn">7</div>
                        <div class="col cell btn">8</div>
                </div>
                <div class="section group repeat">
                        <div class="col cell btn">9</div>
                        <div class="col cell btn">10</div>
                        <div class="col cell btn">11</div>
                        <div class="col cell btn">12</div>
                </div>
                <div class="sep"></div>

		<div class="section group time">
			<div class="col cell btn">1</div>
			<div class="col cell btn">2</div>
			<div class="col cell btn">3</div>
			<div class="col cell btn">4</div>
		</div>
		<div class="section group time">
			<div class="col cell btn">5</div>
			<div class="col cell btn">7</div>
			<div class="col cell btn">10</div>
			<div class="col cell btn">15</div>
		</div>
		<div class="section group time">
			<div class="col cell btn">20</div>
			<div class="col cell btn">30</div>
			<div class="col cell btn">45</div>
			<div class="col cell btn">60</div>
		</div>
	</div>
	<div class="clocks">
		<div class="countdown countdown-container container">
			<div class="clock-item clock-minutes countdown-time-value col-sm-6 col-md-3">
	            <div class="wrap">
	                <div class="inner">
	                    <div id="canvas-minutes" class="clock-canvas"></div>

	                    <div class="text">
	                        <p class="val">0</p>
	                        <p class="type-minutes type-time">MINUTES</p>
	                    </div><!-- /.text -->
	                </div><!-- /.inner -->
	            </div><!-- /.wrap -->
	        </div><!-- /.clock-item -->

	        <div class="clock-item clock-seconds countdown-time-value col-sm-6 col-md-3">
	            <div class="wrap">
	                <div class="inner">
	                    <div id="canvas-seconds" class="clock-canvas"></div>

	                    <div class="text">
	                        <p class="val">0</p>
	                        <p class="type-seconds type-time">SECONDS</p>
	                    </div><!-- /.text -->
	                </div><!-- /.inner -->
	            </div><!-- /.wrap -->
	        </div><!-- /.clock-item -->
   		</div><!-- /.clock -->
	</div>
	<style>

	</style>
	<script type="text/javascript">
		var noSleep = new NoSleep();
		var minDur=60;
		var settleTime=10;
		var sounds = {};
		var duration=0;
		var repeats=2;


		function playEndSound() { console.log("Play End Sound"); sounds.end.play(); }
		function playSound()    { console.log("Play Min Sound"); sounds.minute.play(); }
		
		function active(b)   { $(b).css({'background-color':'#29A329'}); }
		function inactive(b) { $(b).css({'background-color':'#7A29CC'}); }

		function setRepeatCount() { 
			$(".repeat .btn").each(function() { inactive(this); })
			active(this);
			repeats = 0+$(this).text(); 
		}

		function setupMode() { $(".clocks").hide();	$(".buttons").show(); }
		function runMode()   { $(".clocks").show();	$(".buttons").hide(); }

		function startClock(dur) {
			if (repeatCount == 0)
				console.log("Settle: ");
			else
				console.log("Repeat: "+repeatCount);

			var seconds = new Date().getTime() / 1000;
			$('.clocks.countdown').final_countdown({
	            'start': seconds,
	            'end': dur + seconds,
	            'now': seconds},       
	            resetClock, playSound 
	        );
			
		}

		function resetClock(start) {
			repeatCount++;
			playEndSound();
			if (repeatCount == repeats)
			{
				setupMode();
				console.log("Repeat: "+repeatCount);
				noSleep.disable();
				console.log("Sleep: Enabled");
			}
			else
			{
				startClock(duration*minDur);
			}
		}

		function startSS()
		{
			duration = 0+$(this).text();
			runMode();
			repeatCount=-1;
			startClock(settleTime);
			console.log("Sleep: Disabled");
			noSleep.enable();
		}

		$('document').ready(function() {
			var href = ""+$(location).attr('href');			
			//var overrideMinDur=$(location).attr('duration');

			//if (overrideMinDur != "") minDur=0+overrideMinDur;

			sounds.end = new Howl({  src: ["music/templeBell.wav"]});
			sounds.minute = new Howl({  src: ["music/ting.wav"]});
		
			$(".repeat .btn").click(setRepeatCount);
			$(".time .btn").click(startSS);
			active($(".repeat .btn").first());
			setupMode();
		});
		
	</script>
	
	</body>
</html>
